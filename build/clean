#!/bin/bash

BUILD_ROOT=$(dirname $(realpath "${BASH_SOURCE:-0}"))/out
SRC_ROOT=$(dirname $(realpath "${BASH_SOURCE:-0}"))/..

rm -rf $BUILD_ROOT
mkdir $BUILD_ROOT
mkdir $BUILD_ROOT/clang
mkdir $BUILD_ROOT/gcc

mkdir $BUILD_ROOT/clang/deb
cd $BUILD_ROOT/clang/deb
cmake $SRC_ROOT -DCMAKE_BUILD_TYPE=Debug -DCMAKE_PREFIX_PATH=$BUILD_ROOT/deps-install \
    -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DMG_DEBUG_SANITISERS=On \
    -DMG_ENABLE_GFX_DEBUG_GROUPS=On

mkdir $BUILD_ROOT/clang/rel
cd $BUILD_ROOT/clang/rel
cmake $SRC_ROOT -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=$BUILD_ROOT/deps-install \
    -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++

# Not using sanitisers in gcc debug, because they interfere with apitrace and I want at least one
# build I can easily apitrace.
mkdir $BUILD_ROOT/gcc/deb
cd $BUILD_ROOT/gcc/deb
cmake $SRC_ROOT -DCMAKE_BUILD_TYPE=Debug -DCMAKE_PREFIX_PATH=$BUILD_ROOT/deps-install \
    -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ \
    -DMG_ENABLE_GFX_DEBUG_GROUPS=On

mkdir $BUILD_ROOT/gcc/rel
cd $BUILD_ROOT/gcc/rel
cmake $SRC_ROOT -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=$BUILD_ROOT/deps-install \
    -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++

cd $BUILD_ROOT/..
